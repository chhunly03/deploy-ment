name: Auto Deploy Next.js & Notify Telegram

on:
  push:
    branches:
      - main  # or your default branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel Deploy
        run: |
          curl -X POST ${{ secrets.VERCEL_HOOK_URL }}

      - name: Notify Telegram
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - run: |
          npm install node-fetch
          node -e "
            const fetch = require('node-fetch');
            fetch('https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                chat_id: '${{ secrets.TELEGRAM_CHAT_ID }}',
                text: 'âœ… Code pushed and deployment triggered on Vercel!'
              })
            });
          "
