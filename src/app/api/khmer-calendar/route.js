export async function GET(req) {
  const { searchParams } = new URL(req.url);
  const year = parseInt(searchParams.get("year"));
  const month = parseInt(searchParams.get("month"));

  if (isNaN(year) || isNaN(month) || month < 1 || month > 12) {
    return new Response(JSON.stringify({ error: "Invalid year or month" }), {
      status: 400,
      headers: { "Content-Type": "application/json" },
    });
  }

  const daysInMonth = new Date(year, month, 0).getDate();
  const result = [];

  const HOLIDAYS = {
    "01-01": "បុណ្យចូលឆ្នាំសកល",
    "01-07": "ទិវាជ័យជម្នះលើរបបប្រល័យពូជសាសន៍",
    "03-08": "ទិវាស្ត្រីអន្តរជាតិ ខួបលើកទី ១១៤​",
    "04-14": "បុណ្យចូលឆ្នាំខ្មែរ",
    "04-15": "បុណ្យចូលឆ្នាំខ្មែរ",
    "04-16": "បុណ្យចូលឆ្នាំខ្មែរ",
    "05-01": "ទិវា​ពលកម្ម​អន្តរជាតិ ខួបលើកទី១៣៩",
    "05-11": "ពិធី​បុណ្យ​វិសាខ​បូជា",
    "05-14": "ព្រះ​រាជ​ពិធី​បុណ្យ​ចម្រើន​ព្រះ​ជន្ម ព្រះ​ករុណា​ព្រះ​បាទ​សម្តេច​ព្រះ​បរម​នាថ នរោត្តម សីហមុនី ព្រះ​មហាក្សត្រ​នៃ​ព្រះរាជាណាចក្រ​កម្ពុជា",
    "05-15": "ព្រះ​រាជ​ពិធី​ច្រត់​ព្រះ​នង្គ័ល",
    "06-18": "ព្រះ​រាជ​ពិធី​បុណ្យ​ចម្រើន​ព្រះ​ជន្ម សម្តេច​ព្រះ​មហាក្សត្រី នរោត្តម មុនិនាថ សីហនុ ព្រះ​វររាជ​មាតា​ជាតិ​ខ្មែរ ក្នុង​សេរីភាព សេចក្តីថ្លៃថ្នូរ និង​សុភមង្គល",
    "09-21": "បុណ្យភ្ជុំបិណ្ឌ",
    "09-22": "បុណ្យភ្ជុំបិណ្ឌ",
    "09-23": "បុណ្យភ្ជុំបិណ្ឌ",
    "09-24": "ទិវា​ប្រកាស​រដ្ឋ​ធម្មនុញ្ញ ខួបលើកទី៣២",
    "10-15": "ទិវា​ប្រារព្ធ​ពិធី​គោរព​ព្រះវិញ្ញាណក្ខន្ធ ព្រះករុណា​ព្រះបាទ​សម្តេច​ព្រះ នរោត្តម សីហនុ ព្រះមហាវីរក្សត្រ ព្រះ​វររាជ​បិតា​ឯករាជ្យ បូរណភាព​ទឹកដី និង​ឯកភាព​ជាតិ​ខ្មែរ",
    "10-29": "ព្រះ​រាជ​ពិធី​គ្រង​ព្រះ​បរម​រាជ​សម្បត្តិ​របស់​ ព្រះ​ករុណា​ព្រះ​បាទ​សម្តេច​ព្រះ​បរមនាថ នរោត្តម សីហមុនី ព្រះ​មហាក្សត្រ​នៃ​ព្រះរាជាណាចក្រ​កម្ពុជា",
    "11-04": "ព្រះ​រាជ​ពិធី​បុណ្យ​អុំ​ទូក បណ្ដែត​ប្រទីប និង​សំពះ​ព្រះ​ខែ អកអំបុក",
    "11-05": "ព្រះ​រាជ​ពិធី​បុណ្យ​អុំ​ទូក បណ្ដែត​ប្រទីប និង​សំពះ​ព្រះ​ខែ អកអំបុក",
    "11-06": "ព្រះ​រាជ​ពិធី​បុណ្យ​អុំ​ទូក បណ្ដែត​ប្រទីប និង​សំពះ​ព្រះ​ខែ អកអំបុក",
    "11-09": "ទិវា​ជាតិ នៃ​ការ​ប្រារព្ធ​ខួបលើកទី72 នៃ​ការ​ទទួល​បាន​ឯករាជ្យ​ជាតិ ព្រះរាជាណាចក្រ​កម្ពុជា",
    "12-29": "ទិវា​សន្តិ​ភាព​នៅ​កម្ពុជា",
  };

  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(year, month - 1, d);
    const isoDate = date.toLocaleDateString("sv-SE"); // yyyy-mm-dd in local time
    const isSaturday = date.getDay() === 6; // Saturday
    const key = `${String(month).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
    const holidayName = HOLIDAYS[key] || null;

    result.push({
      date: isoDate,
      day: d,
      isSaturday,
      isHoliday: !!holidayName,
      holidayName,
    });
  }

  return new Response(JSON.stringify(result), {
    status: 200,
    headers: { "Content-Type": "application/json" },
  });
}
